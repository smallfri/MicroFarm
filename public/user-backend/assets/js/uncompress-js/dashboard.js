$(function(){var switches=Array.prototype.slice.call(document.querySelectorAll('.switch'));switches.forEach(function(html){var switchery=new Switchery(html,{color:'#4CAF50'});});$('.daterange-ranges').daterangepicker({startDate:moment().subtract('days',29),endDate:moment(),minDate:'01/01/2012',maxDate:'12/31/2016',dateLimit:{days:60},ranges:{'Today':[moment(),moment()],'Yesterday':[moment().subtract('days',1),moment().subtract('days',1)],'Last 7 Days':[moment().subtract('days',6),moment()],'Last 30 Days':[moment().subtract('days',29),moment()],'This Month':[moment().startOf('month'),moment().endOf('month')],'Last Month':[moment().subtract('month',1).startOf('month'),moment().subtract('month',1).endOf('month')]},opens:'left',applyClass:'btn-small bg-slate-600 btn-block',cancelClass:'btn-small btn-default btn-block',format:'MM/DD/YYYY'},function(start,end){$('.daterange-ranges span').html(start.format('MMMM D')+' - '+end.format('MMMM D'));});$('.daterange-ranges span').html(moment().subtract('days',29).format('MMMM D')+' - '+moment().format('MMMM D'));trafficSources('#traffic-sources',330);function trafficSources(element,height){var d3Container=d3.select(element),margin={top:5,right:50,bottom:40,left:50},width=d3Container.node().getBoundingClientRect().width-margin.left-margin.right,height=height-margin.top-margin.bottom,tooltipOffset=30;var tooltip=d3Container.append("div").attr("class","d3-tip e").style("display","none")
var format=d3.time.format("%m/%d/%y %H:%M");var formatDate=d3.time.format("%H:%M");var colorrange=['#03A9F4','#29B6F6','#4FC3F7','#81D4FA','#B3E5FC','#E1F5FE'];var x=d3.time.scale().range([0,width]);var y=d3.scale.linear().range([height,0]);var z=d3.scale.ordinal().range(colorrange);var xAxis=d3.svg.axis().scale(x).orient("bottom").ticks(d3.time.hours,4).innerTickSize(4).tickPadding(8).tickFormat(d3.time.format("%H:%M"));var yAxis=d3.svg.axis().scale(y).ticks(6).innerTickSize(4).outerTickSize(0).tickPadding(8).tickFormat(function(d){return(d/1000)+"k";});var yAxis2=yAxis;var gridAxis=d3.svg.axis().scale(y).orient("left").ticks(6).tickPadding(8).tickFormat("").tickSize(-width,0,0);var container=d3Container.append("svg")
var svg=container.attr('width',width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");var stack=d3.layout.stack().offset("silhouette").values(function(d){return d.values;}).x(function(d){return d.date;}).y(function(d){return d.value;});var nest=d3.nest().key(function(d){return d.key;});var area=d3.svg.area().interpolate("cardinal").x(function(d){return x(d.date);}).y0(function(d){return y(d.y0);}).y1(function(d){return y(d.y0+d.y);});d3.csv("assets/demo_data/dashboard/traffic_sources.csv",function(error,data){data.forEach(function(d){d.date=format.parse(d.date);d.value=+d.value;});var layers=stack(nest.entries(data));x.domain(d3.extent(data,function(d,i){return d.date;}));y.domain([0,d3.max(data,function(d){return d.y0+d.y;})]);svg.append("g").attr("class","d3-grid-dashed").call(gridAxis);var group=svg.append('g').attr('class','streamgraph-layers-group');var layer=group.selectAll(".streamgraph-layer").data(layers).enter().append("path").attr("class","streamgraph-layer").attr("d",function(d){return area(d.values);}).style('stroke','#fff').style('stroke-width',0.5).style("fill",function(d,i){return z(i);});var layerTransition=layer.style('opacity',0).transition().duration(750).delay(function(d,i){return i*50;}).style('opacity',1)
svg.append("g").attr("class","d3-axis d3-axis-left d3-axis-solid").call(yAxis.orient("left"));d3.select(svg.selectAll('.d3-axis-left .tick text')[0][0]).style("visibility","hidden");svg.append("g").attr("class","d3-axis d3-axis-right d3-axis-solid").attr("transform","translate("+width+", 0)").call(yAxis2.orient("right"));d3.select(svg.selectAll('.d3-axis-right .tick text')[0][0]).style("visibility","hidden");var xaxisg=svg.append("g").attr("class","d3-axis d3-axis-horizontal d3-axis-solid").attr("transform","translate(0,"+height+")").call(xAxis);xaxisg.selectAll(".d3-axis-subticks").data(x.ticks(d3.time.hours),function(d){return d;}).enter().append("line").attr("class","d3-axis-subticks").attr("y1",0).attr("y2",4).attr("x1",x).attr("x2",x);var hoverLineGroup=group.append("g").attr("class","hover-line");var hoverLine=hoverLineGroup.append("line").attr("y1",0).attr("y2",height).style('fill','none').style('stroke','#fff').style('stroke-width',1).style('pointer-events','none').style('shape-rendering','crispEdges').style("opacity",0);var hoverPointer=hoverLineGroup.append("rect").attr("x",2).attr("y",2).attr("width",6).attr("height",6).style('fill','#03A9F4').style('stroke','#fff').style('stroke-width',1).style('shape-rendering','crispEdges').style('pointer-events','none').style("opacity",0);layerTransition.each("end",function(){layer.on("mouseover",function(d,i){svg.selectAll(".streamgraph-layer").transition().duration(250).style("opacity",function(d,j){return j!=i?0.75:1;});}).on("mousemove",function(d,i){mouse=d3.mouse(this);mousex=mouse[0];mousey=mouse[1];datearray=[];var invertedx=x.invert(mousex);invertedx=invertedx.getHours();var selected=(d.values);for(var k=0;k<selected.length;k++){datearray[k]=selected[k].date
datearray[k]=datearray[k].getHours();}mousedate=datearray.indexOf(invertedx);pro=d.values[mousedate].value;hoverPointer.attr("x",mousex-3).attr("y",mousey-6).style("opacity",1);hoverLine.attr("x1",mousex).attr("x2",mousex).style("opacity",1);tooltip.html("<ul class='list-unstyled mb-5'>"+"<li>"+"<div class='text-size-base mt-5 mb-5'><i class='icon-circle-left2 position-left'></i>"+d.key+"</div>"+"</li>"+"<li>"+"Visits: &nbsp;"+"<span class='text-semibold pull-right'>"+pro+"</span>"+"</li>"+"<li>"+"Time: &nbsp; "+"<span class='text-semibold pull-right'>"+formatDate(d.values[mousedate].date)+"</span>"+"</li>"+"</ul>").style("display","block");tooltip.append('div').attr('class','d3-tip-arrow');}).on("mouseout",function(d,i){svg.selectAll(".streamgraph-layer").transition().duration(250).style("opacity",1);hoverPointer.style("opacity",0);tooltip.style("display","none");hoverLine.style("opacity",0);});});d3Container.on("mousemove",function(d,i){mouse=d3.mouse(this);mousex=mouse[0];mousey=mouse[1];tooltip.style("top",(mousey-($('.d3-tip').outerHeight()/2))-2+"px")
if(mousex>=($(element).outerWidth()-$('.d3-tip').outerWidth()-margin.right-(tooltipOffset*2))){tooltip.style("left",(mousex-$('.d3-tip').outerWidth()-tooltipOffset)+"px").attr("class","d3-tip w");}else{tooltip.style("left",(mousex+tooltipOffset)+"px").attr("class","d3-tip e");}});});$(window).on('resize',resizeStream);$('.sidebar-control').on('click',resizeStream);function resizeStream(){width=d3Container.node().getBoundingClientRect().width-margin.left-margin.right;container.attr("width",width+margin.left+margin.right);svg.attr("width",width+margin.left+margin.right);x.range([0,width]);svg.selectAll('.d3-axis-horizontal').call(xAxis);svg.selectAll('.d3-axis-subticks').attr("x1",x).attr("x2",x);svg.selectAll(".d3-grid-dashed").call(gridAxis.tickSize(-width,0,0))
svg.selectAll(".d3-axis-right").attr("transform","translate("+width+", 0)");svg.selectAll('.streamgraph-layer').attr("d",function(d){return area(d.values);});}}appSalesLines('#app_sales',255);function appSalesLines(element,height){var d3Container=d3.select(element),margin={top:5,right:30,bottom:30,left:50},width=d3Container.node().getBoundingClientRect().width-margin.left-margin.right,height=height-margin.top-margin.bottom;var tooltip=d3.tip().attr('class','d3-tip').html(function(d){return"<ul class='list-unstyled mb-5'>"+"<li>"+"<div class='text-size-base mt-5 mb-5'><i class='icon-circle-left2 position-left'></i>"+d.name+" app"+"</div>"+"</li>"+"<li>"+"Sales: &nbsp;"+"<span class='text-semibold pull-right'>"+d.value+"</span>"+"</li>"+"<li>"+"Revenue: &nbsp; "+"<span class='text-semibold pull-right'>"+"$"+(d.value*25).toFixed(2)+"</span>"+"</li>"+"</ul>";});var parseDate=d3.time.format("%Y/%m/%d").parse,formatDate=d3.time.format("%b %d, '%y");var scale=["#4CAF50","#FF5722","#5C6BC0"],color=d3.scale.ordinal().range(scale);var container=d3Container.append('svg');var svg=container.attr('width',width+margin.left+margin.right).attr('height',height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(tooltip);var menu=$("#select_date").multiselect({buttonClass:'btn btn-link text-semibold',enableHTML:true,dropRight:true,onChange:function(){change(),$.uniform.update();},buttonText:function(options,element){var selected='';options.each(function(){selected+=$(this).html()+', ';});return'<span class="status-mark border-warning position-left"></span>'+selected.substr(0,selected.length-2);}});$(".multiselect-container input").uniform({radioClass:'choice'});d3.csv("assets/demo_data/dashboard/app_sales.csv",function(error,data){formatted=data;redraw();});var altKey;d3.select(window).on("keydown",function(){altKey=d3.event.altKey;}).on("keyup",function(){altKey=false;});function change(){d3.transition().duration(altKey?7500:500).each(redraw);}function redraw(){var nested=d3.nest().key(function(d){return d.type;}).map(formatted)
var series=menu.val();var data=nested[series];color.domain(d3.keys(data[0]).filter(function(key){return(key!=="date"&&key!=="type");}));var linedata=color.domain().map(function(name){return{name:name,values:data.map(function(d){return{name:name,date:parseDate(d.date),value:parseFloat(d[name],10)};})};});var line=d3.svg.line().x(function(d){return x(d.date);}).y(function(d){return y(d.value);}).interpolate('cardinal');var x=d3.time.scale().domain([d3.min(linedata,function(c){return d3.min(c.values,function(v){return v.date;});}),d3.max(linedata,function(c){return d3.max(c.values,function(v){return v.date;});})]).range([0,width]);var y=d3.scale.linear().domain([d3.min(linedata,function(c){return d3.min(c.values,function(v){return v.value;});}),d3.max(linedata,function(c){return d3.max(c.values,function(v){return v.value;});})]).range([height,0]);var xAxis=d3.svg.axis().scale(x).orient("bottom").tickPadding(8).ticks(d3.time.days).innerTickSize(4).tickFormat(d3.time.format("%a"));var yAxis=d3.svg.axis().scale(y).orient("left").ticks(6).tickSize(0-width).tickPadding(8);svg.append("g").attr("class","d3-axis d3-axis-horizontal d3-axis-solid").attr("transform","translate(0,"+height+")");svg.append("g").attr("class","d3-axis d3-axis-vertical d3-axis-transparent");var lines=svg.selectAll(".lines").data(linedata)
var lineGroup=lines.enter().append("g").attr("class","lines").attr('id',function(d){return d.name+"-line";});lineGroup.append("path").attr("class","d3-line d3-line-medium").style("stroke",function(d){return color(d.name);}).style('opacity',0).attr("d",function(d){return line(d.values[0]);}).transition().duration(500).delay(function(d,i){return i*200;}).style('opacity',1);var circles=lines.selectAll("circle").data(function(d){return d.values;}).enter().append("circle").attr("class","d3-line-circle d3-line-circle-medium").attr("cx",function(d,i){return x(d.date)}).attr("cy",function(d,i){return y(d.value)}).attr("r",3).style('fill','#fff').style("stroke",function(d){return color(d.name);});circles.style('opacity',0).transition().duration(500).delay(500).style('opacity',1);circles.on("mouseover",function(d){tooltip.offset([-15,0]).show(d);d3.select(this).transition().duration(250).attr('r',4);}).on("mouseout",function(d){tooltip.hide(d);d3.select(this).transition().duration(250).attr('r',3);});lines.each(function(d){d3.select(d3.select(this).selectAll('circle')[0][0]).on("mouseover",function(d){tooltip.offset([0,15]).direction('e').show(d);d3.select(this).transition().duration(250).attr('r',4);}).on("mouseout",function(d){tooltip.direction('n').hide(d);d3.select(this).transition().duration(250).attr('r',3);});})
lines.each(function(d){d3.select(d3.select(this).selectAll('circle')[0][d3.select(this).selectAll('circle').size()-1]).on("mouseover",function(d){tooltip.offset([0,-15]).direction('w').show(d);d3.select(this).transition().duration(250).attr('r',4);}).on("mouseout",function(d){tooltip.direction('n').hide(d);d3.select(this).transition().duration(250).attr('r',3);})})
var lineUpdate=d3.transition(lines);lineUpdate.select("path").attr("d",function(d,i){return line(d.values);});lineUpdate.selectAll("circle").attr("cy",function(d,i){return y(d.value)}).attr("cx",function(d,i){return x(d.date)});d3.transition(svg).select(".d3-axis-vertical").call(yAxis);d3.transition(svg).select(".d3-axis-horizontal").attr("transform","translate(0,"+height+")").call(xAxis);$(window).on('resize',appSalesResize);$('.sidebar-control').on('click',appSalesResize);function appSalesResize(){width=d3Container.node().getBoundingClientRect().width-margin.left-margin.right;container.attr("width",width+margin.left+margin.right);svg.attr("width",width+margin.left+margin.right);x.range([0,width]);y.range([height,0]);svg.select('.d3-axis-horizontal').call(xAxis);svg.select('.d3-axis-vertical').call(yAxis.tickSize(0-width));svg.selectAll('.d3-line').attr("d",function(d,i){return line(d.values);});svg.selectAll('.d3-line-circle').attr("cx",function(d,i){return x(d.date)})}}}salesHeatmap();function salesHeatmap(){d3.csv("assets/demo_data/dashboard/app_sales_heatmap.csv",function(error,data){var nested_data=d3.nest().key(function(d){return d.app;}),nest=nested_data.entries(data);var format=d3.time.format("%Y/%m/%d %H:%M"),formatTime=d3.time.format("%H:%M");data.forEach(function(d,i){d.date=format.parse(d.date),d.value=+d.value});var d3Container=d3.select('#sales-heatmap');margin={top:20,right:0,bottom:30,left:0},width=d3Container.node().getBoundingClientRect().width-margin.left-margin.right,gridSize=width/new Date(data[data.length-1].date).getHours(),rowGap=40,height=(rowGap+gridSize)*(d3.max(nest,function(d,i){return i+1}))-margin.top,buckets=5,colors=["#DCEDC8","#C5E1A5","#9CCC65","#7CB342","#558B2F"];var x=d3.time.scale().range([0,width]);var y=d3.scale.linear().range([height,0]);var colorScale=d3.scale.quantile().domain([0,buckets-1,d3.max(data,function(d){return d.value;})]).range(colors);x.domain([new Date(data[0].date),d3.time.hour.offset(new Date(data[data.length-1].date),1)]);y.domain([0,d3.max(data,function(d){return d.app;})]);var container=d3Container.append('svg');var svg=container.attr('width',width+margin.left+margin.right).attr("height",height+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");var hourGroup=svg.selectAll('.hour-group').data(nest).enter().append('g').attr('class','hour-group').attr("transform",function(d,i){return"translate(0, "+((gridSize+rowGap)*i)+")";});hourGroup.append("text").attr('class','app-label').attr('x',0).attr('y',-(margin.top/2)).text(function(d,i){return d.key;});hourGroup.append("text").attr('class','sales-count').attr('x',width).attr('y',-(margin.top/2)).style('text-anchor','end').text(function(d,i){return d3.sum(d.values,function(d){return d.value;})+" sales today"});var heatMap=hourGroup.selectAll(".heatmap-hour").data(function(d){return d.values}).enter().append("rect").attr("x",function(d,i){return x(d.date);}).attr("y",0).attr("class","heatmap-hour").attr("width",gridSize).attr("height",gridSize).style("fill",'#fff').style('stroke','#fff').style('cursor','pointer').style('shape-rendering','crispEdges');heatMap.transition().duration(250).delay(function(d,i){return i*20;}).style("fill",function(d){return colorScale(d.value);})
hourGroup.each(function(d){heatMap.on("mouseover",function(d,i){d3.select(this).style('opacity',0.75);d3.select(this.parentNode).select('.sales-count').text(function(d){return d.values[i].value+" sales at "+formatTime(d.values[i].date);})}).on("mouseout",function(d,i){d3.select(this).style('opacity',1);d3.select(this.parentNode).select('.sales-count').text(function(d,i){return d3.sum(d.values,function(d){return d.value;})+" sales today"})})})
var minValue,maxValue;data.forEach(function(d,i){maxValue=d3.max(data,function(d){return d.value;});minValue=d3.min(data,function(d){return d.value;});});var legendGroup=svg.append('g').attr('class','legend-group').attr('width',width).attr("transform","translate("+((width/2)-((buckets*gridSize))/2)+","+(height+(margin.bottom-margin.top))+")");var legend=legendGroup.selectAll(".heatmap-legend").data([0].concat(colorScale.quantiles()),function(d){return d;}).enter().append("g").attr("class","heatmap-legend");legend.append("rect").attr('class','heatmap-legend-item').attr("x",function(d,i){return gridSize*i;}).attr("y",-8).attr("width",gridSize).attr("height",5).style('stroke','#fff').style('shape-rendering','crispEdges').style("fill",function(d,i){return colors[i];});legendGroup.append("text").attr("class","min-legend-value").attr("x",-10).attr("y",-2).style('text-anchor','end').style('font-size',11).style('fill','#999').text(minValue);legendGroup.append("text").attr("class","max-legend-value").attr("x",(buckets*gridSize)+10).attr("y",-2).style('font-size',11).style('fill','#999').text(maxValue);$(window).on('resize',resizeHeatmap);$('.sidebar-control').on('click',resizeHeatmap);function resizeHeatmap(){width=d3Container.node().getBoundingClientRect().width-margin.left-margin.right,gridSize=width/new Date(data[data.length-1].date).getHours(),height=(rowGap+gridSize)*(d3.max(nest,function(d,i){return i+1}))-margin.top,container.attr("width",width+margin.left+margin.right).attr("height",height+margin.bottom);svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.bottom);x.range([0,width]);svg.selectAll('.hour-group').attr("transform",function(d,i){return"translate(0, "+((gridSize+rowGap)*i)+")";});svg.selectAll(".heatmap-hour").attr("width",gridSize).attr("height",gridSize).attr("x",function(d,i){return x(d.date);});svg.selectAll('.legend-group').attr("transform","translate("+((width/2)-((buckets*gridSize))/2)+","+(height+margin.bottom-margin.top)+")");svg.selectAll('.sales-count').attr("x",width);svg.selectAll('.heatmap-legend-item').attr("width",gridSize).attr("x",function(d,i){return gridSize*i;});svg.selectAll('.max-legend-value').attr("x",(buckets*gridSize)+10);}});}monthlySalesArea("#monthly-sales-stats",100,'#4DB6AC');function monthlySalesArea(element,height,color){var d3Container=d3.select(element),margin={top:20,right:35,bottom:40,left:35},width=d3Container.node().getBoundingClientRect().width-margin.left-margin.right,height=height-margin.top-margin.bottom;var parseDate=d3.time.format('%Y-%m-%d').parse,bisectDate=d3.bisector(function(d){return d.date;}).left,formatDate=d3.time.format("%b %d");var container=d3Container.append('svg');var svg=container.attr('width',width+margin.left+margin.right).attr('height',height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")")
var area=d3.svg.area().x(function(d){return x(d.date);}).y0(height).y1(function(d){return y(d.value);}).interpolate('monotone')
var x=d3.time.scale().range([0,width]);var y=d3.scale.linear().range([height,0]);var xAxis=d3.svg.axis().scale(x).orient("bottom").ticks(d3.time.days,6).innerTickSize(4).tickPadding(8).tickFormat(d3.time.format("%b %d"));d3.json("assets/demo_data/dashboard/monthly_sales.json",function(error,data){if(error)return console.error(error);data.forEach(function(d){d.date=parseDate(d.date);d.value=+d.value;});var maxY=d3.max(data,function(d){return d.value;});var startData=data.map(function(datum){return{date:datum.date,value:0};});x.domain(d3.extent(data,function(d,i){return d.date;}));y.domain([0,d3.max(data,function(d){return d.value;})]);var horizontalAxis=svg.append("g").attr("class","d3-axis d3-axis-horizontal d3-axis-solid").attr("transform","translate(0,"+height+")").call(xAxis);horizontalAxis.selectAll(".d3-axis-subticks").data(x.ticks(d3.time.days),function(d){return d;}).enter().append("line").attr("class","d3-axis-subticks").attr("y1",0).attr("y2",4).attr("x1",x).attr("x2",x);svg.append("path").datum(data).attr("class","d3-area").attr("d",area).style('fill',color).transition().duration(1000).attrTween('d',function(){var interpolator=d3.interpolateArray(startData,data);return function(t){return area(interpolator(t));}});var focusLine=svg.append("g").attr("class","d3-crosshair-line").style("display","none");focusLine.append("line").attr("class","vertical-crosshair").attr("y1",0).attr("y2",-maxY).style("stroke","#e5e5e5").style('shape-rendering','crispEdges')
var focusPointer=svg.append("g").attr("class","d3-crosshair-pointer").style("display","none");focusPointer.append("circle").attr("r",3).style("fill","#fff").style('stroke',color).style('stroke-width',1)
var focusText=svg.append("g").attr("class","d3-crosshair-text").style("display","none");focusText.append("text").attr("dy",-10).style('font-size',12);svg.append("rect").attr("class","d3-crosshair-overlay").style('fill','none').style('pointer-events','all').attr("width",width).attr("height",height).on("mouseover",function(){focusPointer.style("display",null);focusLine.style("display",null)
focusText.style("display",null);}).on("mouseout",function(){focusPointer.style("display","none");focusLine.style("display","none");focusText.style("display","none");}).on("mousemove",mousemove);function mousemove(){var mouse=d3.mouse(this),mousex=mouse[0],mousey=mouse[1],x0=x.invert(mousex),i=bisectDate(data,x0),d0=data[i-1],d1=data[i],d=x0-d0.date>d1.date-x0?d1:d0;focusLine.attr("transform","translate("+x(d.date)+","+height+")");focusPointer.attr("transform","translate("+x(d.date)+","+y(d.value)+")");if(mousex>=(d3Container.node().getBoundingClientRect().width-focusText.select('text').node().getBoundingClientRect().width-margin.right-margin.left)){focusText.select("text").attr('text-anchor','end').attr("x",function(){return(x(d.date)-15)+"px"}).text(formatDate(d.date)+" - "+d.value+" sales");}else{focusText.select("text").attr('text-anchor','start').attr("x",function(){return(x(d.date)+15)+"px"}).text(formatDate(d.date)+" - "+d.value+" sales");}}$(window).on('resize',monthlySalesAreaResize);$('.sidebar-control').on('click',monthlySalesAreaResize);function monthlySalesAreaResize(){width=d3Container.node().getBoundingClientRect().width-margin.left-margin.right;container.attr("width",width+margin.left+margin.right);svg.attr("width",width+margin.left+margin.right);x.range([0,width]);svg.selectAll('.d3-axis-horizontal').call(xAxis);svg.selectAll('.d3-axis-subticks').attr("x1",x).attr("x2",x);svg.selectAll('.d3-area').datum(data).attr("d",area);svg.selectAll('.d3-crosshair-overlay').attr("width",width);}});}messagesArea("#messages-stats",40,'#5C6BC0');function messagesArea(element,height,color){var d3Container=d3.select(element),margin={top:0,right:0,bottom:0,left:0},width=d3Container.node().getBoundingClientRect().width-margin.left-margin.right,height=height-margin.top-margin.bottom;var parseDate=d3.time.format('%Y-%m-%d').parse;var container=d3Container.append('svg');var svg=container.attr('width',width+margin.left+margin.right).attr('height',height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")")
var area=d3.svg.area().x(function(d){return x(d.date);}).y0(height).y1(function(d){return y(d.value);}).interpolate('monotone')
var x=d3.time.scale().range([0,width]);var y=d3.scale.linear().range([height,0]);d3.json("assets/demo_data/dashboard/monthly_sales.json",function(error,data){if(error)return console.error(error);data.forEach(function(d){d.date=parseDate(d.date);d.value=+d.value;});var maxY=d3.max(data,function(d){return d.value;});var startData=data.map(function(datum){return{date:datum.date,value:0};});x.domain(d3.extent(data,function(d,i){return d.date;}));y.domain([0,d3.max(data,function(d){return d.value;})]);svg.append("path").datum(data).attr("class","d3-area").style('fill',color).attr("d",area).transition().duration(1000).attrTween('d',function(){var interpolator=d3.interpolateArray(startData,data);return function(t){return area(interpolator(t));}});$(window).on('resize',messagesAreaResize);$('.sidebar-control').on('click',messagesAreaResize);function messagesAreaResize(){width=d3Container.node().getBoundingClientRect().width-margin.left-margin.right;container.attr("width",width+margin.left+margin.right);svg.attr("width",width+margin.left+margin.right);x.range([0,width]);svg.selectAll('.d3-area').datum(data).attr("d",area);}});}sparkline("#new-visitors","line",30,35,"basis",750,2000,"#26A69A");sparkline("#new-sessions","line",30,35,"basis",750,2000,"#FF7043");sparkline("#total-online","line",30,35,"basis",750,2000,"#5C6BC0");sparkline("#server-load","area",30,50,"basis",750,2000,"rgba(255,255,255,0.5)");function sparkline(element,chartType,qty,height,interpolation,duration,interval,color){var d3Container=d3.select(element),margin={top:0,right:0,bottom:0,left:0},width=d3Container.node().getBoundingClientRect().width-margin.left-margin.right,height=height-margin.top-margin.bottom;var data=[];for(var i=0;i<qty;i++){data.push(Math.floor(Math.random()*qty)+5)}var x=d3.scale.linear().range([0,width]);var y=d3.scale.linear().range([height-5,5]);x.domain([1,qty-3])
y.domain([0,qty])
var line=d3.svg.line().interpolate(interpolation).x(function(d,i){return x(i);}).y(function(d,i){return y(d);});var area=d3.svg.area().interpolate(interpolation).x(function(d,i){return x(i);}).y0(height).y1(function(d){return y(d);});var container=d3Container.append('svg');var svg=container.attr('width',width+margin.left+margin.right).attr('height',height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");var clip=svg.append("defs").append("clipPath").attr('id',function(d,i){return"load-clip-"+element.substring(1)})
var clips=clip.append("rect").attr('class','load-clip').attr("width",0).attr("height",height);clips.transition().duration(1000).ease('linear').attr("width",width);var path=svg.append("g").attr("clip-path",function(d,i){return"url(#load-clip-"+element.substring(1)+")"}).append("path").datum(data).attr("transform","translate("+x(0)+",0)");if(chartType=="area"){path.attr("d",area).attr('class','d3-area').style("fill",color);}else{path.attr("d",line).attr("class","d3-line d3-line-medium").style('stroke',color);}path.style('opacity',0).transition().duration(750).style('opacity',1);setInterval(function(){data.push(Math.floor(Math.random()*qty)+5);data.shift();update();},interval);function update(){path.attr("transform",null).transition().duration(duration).ease("linear").attr("transform","translate("+x(0)+",0)");if(chartType=="area"){path.attr("d",area).attr('class','d3-area').style("fill",color)}else{path.attr("d",line).attr("class","d3-line d3-line-medium").style('stroke',color);}}$(window).on('resize',resizeSparklines);$('.sidebar-control').on('click',resizeSparklines);function resizeSparklines(){width=d3Container.node().getBoundingClientRect().width-margin.left-margin.right;container.attr("width",width+margin.left+margin.right);svg.attr("width",width+margin.left+margin.right);x.range([0,width]);clips.attr("width",width);svg.select(".d3-line").attr("d",line);svg.select(".d3-area").attr("d",area);}}dailyRevenue('#today-revenue',50);function dailyRevenue(element,height){var dataset=[{"date":"04/13/14","alpha":"60"},{"date":"04/14/14","alpha":"35"},{"date":"04/15/14","alpha":"65"},{"date":"04/16/14","alpha":"50"},{"date":"04/17/14","alpha":"65"},{"date":"04/18/14","alpha":"20"},{"date":"04/19/14","alpha":"60"}];var d3Container=d3.select(element),margin={top:0,right:0,bottom:0,left:0},width=d3Container.node().getBoundingClientRect().width-margin.left-margin.right,height=height-margin.top-margin.bottom,padding=20;var parseDate=d3.time.format("%m/%d/%y").parse,formatDate=d3.time.format("%a, %B %e");var tooltip=d3.tip().attr('class','d3-tip').html(function(d){return"<ul class='list-unstyled mb-5'>"+"<li>"+"<div class='text-size-base mt-5 mb-5'><i class='icon-check2 position-left'></i>"+formatDate(d.date)+"</div>"+"</li>"+"<li>"+"Sales: &nbsp;"+"<span class='text-semibold pull-right'>"+d.alpha+"</span>"+"</li>"+"<li>"+"Revenue: &nbsp; "+"<span class='text-semibold pull-right'>"+"$"+(d.alpha*25).toFixed(2)+"</span>"+"</li>"+"</ul>";});var container=d3Container.append('svg');var svg=container.attr('width',width+margin.left+margin.right).attr('height',height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(tooltip);dataset.forEach(function(d){d.date=parseDate(d.date);d.alpha=+d.alpha;});var x=d3.time.scale().range([padding,width-padding]);var y=d3.scale.linear().range([height,5]);x.domain(d3.extent(dataset,function(d){return d.date;}));y.domain([0,d3.max(dataset,function(d){return Math.max(d.alpha);})]);var line=d3.svg.line().x(function(d){return x(d.date);}).y(function(d){return y(d.alpha)});var clip=svg.append("defs").append("clipPath").attr("id","clip-line-small");var clipRect=clip.append("rect").attr('class','clip').attr("width",0).attr("height",height);clipRect.transition().duration(1000).ease('linear').attr("width",width);var path=svg.append('path').attr({'d':line(dataset),"clip-path":"url(#clip-line-small)",'class':'d3-line d3-line-medium'}).style('stroke','#fff');svg.select('.line-tickets').transition().duration(1000).ease('linear');var guide=svg.append('g').selectAll('.d3-line-guides-group').data(dataset);guide.enter().append('line').attr('class','d3-line-guides').attr('x1',function(d,i){return x(d.date);}).attr('y1',function(d,i){return height;}).attr('x2',function(d,i){return x(d.date);}).attr('y2',function(d,i){return height;}).style('stroke','rgba(255,255,255,0.3)').style('stroke-dasharray','4,2').style('shape-rendering','crispEdges');guide.transition().duration(1000).delay(function(d,i){return i*150;}).attr('y2',function(d,i){return y(d.alpha);});var points=svg.insert('g').selectAll('.d3-line-circle').data(dataset).enter().append('circle').attr('class','d3-line-circle d3-line-circle-medium').attr("cx",line.x()).attr("cy",line.y()).attr("r",3).style('stroke','#fff').style('fill','#29B6F6');points.style('opacity',0).transition().duration(250).ease('linear').delay(1000).style('opacity',1);points.on("mouseover",function(d){tooltip.offset([-10,0]).show(d);d3.select(this).transition().duration(250).attr('r',4);}).on("mouseout",function(d){tooltip.hide(d);d3.select(this).transition().duration(250).attr('r',3);});d3.select(points[0][0]).on("mouseover",function(d){tooltip.offset([0,10]).direction('e').show(d);d3.select(this).transition().duration(250).attr('r',4);}).on("mouseout",function(d){tooltip.direction('n').hide(d);d3.select(this).transition().duration(250).attr('r',3);});d3.select(points[0][points.size()-1]).on("mouseover",function(d){tooltip.offset([0,-10]).direction('w').show(d);d3.select(this).transition().duration(250).attr('r',4);}).on("mouseout",function(d){tooltip.direction('n').hide(d);d3.select(this).transition().duration(250).attr('r',3);})
$(window).on('resize',revenueResize);$('.sidebar-control').on('click',revenueResize);function revenueResize(){width=d3Container.node().getBoundingClientRect().width-margin.left-margin.right;container.attr("width",width+margin.left+margin.right);svg.attr("width",width+margin.left+margin.right);x.range([padding,width-padding]);clipRect.attr("width",width);svg.selectAll('.d3-line').attr("d",line(dataset));svg.selectAll('.d3-line-circle').attr("cx",line.x());svg.selectAll('.d3-line-guides').attr('x1',function(d,i){return x(d.date);}).attr('x2',function(d,i){return x(d.date);});}}progressMeter("#today-progress",20,20,'#7986CB');progressMeter("#yesterday-progress",20,20,'#7986CB');function progressMeter(element,width,height,color){var d3Container=d3.select(element),border=2,radius=Math.min(width/2,height/2)-border,twoPi=2*Math.PI,progress=$(element).data('progress'),total=100;var arc=d3.svg.arc().startAngle(0).innerRadius(0).outerRadius(radius).endAngle(function(d){return(d.value/d.size)*2*Math.PI;})
var container=d3Container.append("svg");var svg=container.attr("width",width).attr("height",height).append("g").attr("transform","translate("+width/2+","+height/2+")");var meter=svg.append("g").attr("class","progress-meter");meter.append("path").attr("d",arc.endAngle(twoPi)).style('fill','#fff').style('stroke',color).style('stroke-width',1.5);var foreground=meter.append("path").style('fill',color);foreground.transition().ease("cubic-out").duration(2500).attrTween("d",arcTween);function arcTween(){var i=d3.interpolate(0,progress);return function(t){var currentProgress=progress/(100/t);var endAngle=arc.endAngle(twoPi*(currentProgress));return arc(i(endAngle));};}}campaignDonut("#campaigns-donut",42);function campaignDonut(element,size){var data=[{"browser":"Google Adwords","icon":"<i class='icon-google position-left'></i>","value":1047,"color":"#66BB6A"},{"browser":"Social media","icon":"<i class='icon-share4 position-left'></i>","value":2948,"color":"#9575CD"},{"browser":"Youtube video","icon":"<i class='icon-youtube position-left'></i>","value":3909,"color":"#FF7043"}];var d3Container=d3.select(element),distance=2,radius=(size/2)-distance,sum=d3.sum(data,function(d){return d.value;})
var tip=d3.tip().attr('class','d3-tip').offset([-10,0]).direction('e').html(function(d){return"<ul class='list-unstyled mb-5'>"+"<li>"+"<div class='text-size-base mb-5 mt-5'>"+d.data.icon+d.data.browser+"</div>"+"</li>"+"<li>"+"Visits: &nbsp;"+"<span class='text-semibold pull-right'>"+d.value+"</span>"+"</li>"+"<li>"+"Share: &nbsp;"+"<span class='text-semibold pull-right'>"+(100/(sum/d.value)).toFixed(2)+"%"+"</span>"+"</li>"+"</ul>";})
var container=d3Container.append("svg").call(tip);var svg=container.attr("width",size).attr("height",size).append("g").attr("transform","translate("+(size/2)+","+(size/2)+")");var pie=d3.layout.pie().sort(null).startAngle(Math.PI).endAngle(3*Math.PI).value(function(d){return d.value;});var arc=d3.svg.arc().outerRadius(radius).innerRadius(radius/2);var arcGroup=svg.selectAll(".d3-arc").data(pie(data)).enter().append("g").attr("class","d3-arc").style('stroke','#fff').style('cursor','pointer');var arcPath=arcGroup.append("path").style("fill",function(d){return d.data.color;});arcPath.on('mouseover',function(d,i){d3.select(this).transition().duration(500).ease('elastic').attr('transform',function(d){d.midAngle=((d.endAngle-d.startAngle)/2)+d.startAngle;var x=Math.sin(d.midAngle)*distance;var y=-Math.cos(d.midAngle)*distance;return'translate('+x+','+y+')';});}).on("mousemove",function(d){tip.show(d).style("top",(d3.event.pageY-40)+"px").style("left",(d3.event.pageX+30)+"px");}).on('mouseout',function(d,i){d3.select(this).transition().duration(500).ease('bounce').attr('transform','translate(0,0)');tip.hide(d);});arcPath.transition().delay(function(d,i){return i*500;}).duration(500).attrTween("d",function(d){var interpolate=d3.interpolate(d.startAngle,d.endAngle);return function(t){d.endAngle=interpolate(t);return arc(d);};});}campaignStatusPie("#campaign-status-pie",42);function campaignStatusPie(element,size){var data=[{"status":"Active campaigns","icon":"<span class='status-mark border-blue-300 position-left'></span>","value":439,"color":"#29B6F6"},{"status":"Closed campaigns","icon":"<span class='status-mark border-danger-300 position-left'></span>","value":290,"color":"#EF5350"},{"status":"Pending campaigns","icon":"<span class='status-mark border-success-300 position-left'></span>","value":190,"color":"#81C784"},{"status":"Campaigns on hold","icon":"<span class='status-mark border-grey-300 position-left'></span>","value":148,"color":"#999"}];var d3Container=d3.select(element),distance=2,radius=(size/2)-distance,sum=d3.sum(data,function(d){return d.value;})
var tip=d3.tip().attr('class','d3-tip').offset([-10,0]).direction('e').html(function(d){return"<ul class='list-unstyled mb-5'>"+"<li>"+"<div class='text-size-base mb-5 mt-5'>"+d.data.icon+d.data.status+"</div>"+"</li>"+"<li>"+"Total: &nbsp;"+"<span class='text-semibold pull-right'>"+d.value+"</span>"+"</li>"+"<li>"+"Share: &nbsp;"+"<span class='text-semibold pull-right'>"+(100/(sum/d.value)).toFixed(2)+"%"+"</span>"+"</li>"+"</ul>";})
var container=d3Container.append("svg").call(tip);var svg=container.attr("width",size).attr("height",size).append("g").attr("transform","translate("+(size/2)+","+(size/2)+")");var pie=d3.layout.pie().sort(null).startAngle(Math.PI).endAngle(3*Math.PI).value(function(d){return d.value;});var arc=d3.svg.arc().outerRadius(radius).innerRadius(radius/2);var arcGroup=svg.selectAll(".d3-arc").data(pie(data)).enter().append("g").attr("class","d3-arc").style('stroke','#fff').style('cursor','pointer');var arcPath=arcGroup.append("path").style("fill",function(d){return d.data.color;});arcPath.on('mouseover',function(d,i){d3.select(this).transition().duration(500).ease('elastic').attr('transform',function(d){d.midAngle=((d.endAngle-d.startAngle)/2)+d.startAngle;var x=Math.sin(d.midAngle)*distance;var y=-Math.cos(d.midAngle)*distance;return'translate('+x+','+y+')';});}).on("mousemove",function(d){tip.show(d).style("top",(d3.event.pageY-40)+"px").style("left",(d3.event.pageX+30)+"px");}).on('mouseout',function(d,i){d3.select(this).transition().duration(500).ease('bounce').attr('transform','translate(0,0)');tip.hide(d);});arcPath.transition().delay(function(d,i){return i*500;}).duration(500).attrTween("d",function(d){var interpolate=d3.interpolate(d.startAngle,d.endAngle);return function(t){d.endAngle=interpolate(t);return arc(d);};});}ticketStatusDonut("#tickets-status",42);function ticketStatusDonut(element,size){var data=[{"status":"Pending tickets","icon":"<i class='status-mark border-blue-300 position-left'></i>","value":295,"color":"#29B6F6"},{"status":"Resolved tickets","icon":"<i class='status-mark border-success-300 position-left'></i>","value":189,"color":"#66BB6A"},{"status":"Closed tickets","icon":"<i class='status-mark border-danger-300 position-left'></i>","value":277,"color":"#EF5350"}];var d3Container=d3.select(element),distance=2,radius=(size/2)-distance,sum=d3.sum(data,function(d){return d.value;})
var tip=d3.tip().attr('class','d3-tip').offset([-10,0]).direction('e').html(function(d){return"<ul class='list-unstyled mb-5'>"+"<li>"+"<div class='text-size-base mb-5 mt-5'>"+d.data.icon+d.data.status+"</div>"+"</li>"+"<li>"+"Total: &nbsp;"+"<span class='text-semibold pull-right'>"+d.value+"</span>"+"</li>"+"<li>"+"Share: &nbsp;"+"<span class='text-semibold pull-right'>"+(100/(sum/d.value)).toFixed(2)+"%"+"</span>"+"</li>"+"</ul>";})
var container=d3Container.append("svg").call(tip);var svg=container.attr("width",size).attr("height",size).append("g").attr("transform","translate("+(size/2)+","+(size/2)+")");var pie=d3.layout.pie().sort(null).startAngle(Math.PI).endAngle(3*Math.PI).value(function(d){return d.value;});var arc=d3.svg.arc().outerRadius(radius).innerRadius(radius/2);var arcGroup=svg.selectAll(".d3-arc").data(pie(data)).enter().append("g").attr("class","d3-arc").style('stroke','#fff').style('cursor','pointer');var arcPath=arcGroup.append("path").style("fill",function(d){return d.data.color;});arcPath.on('mouseover',function(d,i){d3.select(this).transition().duration(500).ease('elastic').attr('transform',function(d){d.midAngle=((d.endAngle-d.startAngle)/2)+d.startAngle;var x=Math.sin(d.midAngle)*distance;var y=-Math.cos(d.midAngle)*distance;return'translate('+x+','+y+')';});}).on("mousemove",function(d){tip.show(d).style("top",(d3.event.pageY-40)+"px").style("left",(d3.event.pageX+30)+"px");}).on('mouseout',function(d,i){d3.select(this).transition().duration(500).ease('bounce').attr('transform','translate(0,0)');tip.hide(d);});arcPath.transition().delay(function(d,i){return i*500;}).duration(500).attrTween("d",function(d){var interpolate=d3.interpolate(d.startAngle,d.endAngle);return function(t){d.endAngle=interpolate(t);return arc(d);};});}generateBarChart("#hours-available-bars",24,40,true,"elastic",1200,50,"#EC407A","hours");generateBarChart("#goal-bars",24,40,true,"elastic",1200,50,"#5C6BC0","goal");generateBarChart("#members-online",24,50,true,"elastic",1200,50,"rgba(255,255,255,0.5)","members");function generateBarChart(element,barQty,height,animate,easing,duration,delay,color,tooltip){var bardata=[];for(var i=0;i<barQty;i++){bardata.push(Math.round(Math.random()*10)+10)}var d3Container=d3.select(element),width=d3Container.node().getBoundingClientRect().width;var x=d3.scale.ordinal().rangeBands([0,width],0.3)
var y=d3.scale.linear().range([0,height]);x.domain(d3.range(0,bardata.length))
y.domain([0,d3.max(bardata)])
var container=d3Container.append('svg');var svg=container.attr('width',width).attr('height',height).append('g');var bars=svg.selectAll('rect').data(bardata).enter().append('rect').attr('class','d3-random-bars').attr('width',x.rangeBand()).attr('x',function(d,i){return x(i);}).style('fill',color);var tip=d3.tip().attr('class','d3-tip').offset([-10,0]);if(tooltip=="hours"||tooltip=="goal"||tooltip=="members"){bars.call(tip).on('mouseover',tip.show).on('mouseout',tip.hide);}if(tooltip=="hours"){tip.html(function(d,i){return"<div class='text-center'>"+"<h6 class='no-margin'>"+d+"</h6>"+"<span class='text-size-small'>meetings</span>"+"<div class='text-size-small'>"+i+":00"+"</div>"+"</div>"});}if(tooltip=="goal"){tip.html(function(d,i){return"<div class='text-center'>"+"<h6 class='no-margin'>"+d+"</h6>"+"<span class='text-size-small'>statements</span>"+"<div class='text-size-small'>"+i+":00"+"</div>"+"</div>"});}if(tooltip=="members"){tip.html(function(d,i){return"<div class='text-center'>"+"<h6 class='no-margin'>"+d+"0"+"</h6>"+"<span class='text-size-small'>members</span>"+"<div class='text-size-small'>"+i+":00"+"</div>"+"</div>"});}if(animate){withAnimation();}else{withoutAnimation();}function withAnimation(){bars.attr('height',0).attr('y',height).transition().attr('height',function(d){return y(d);}).attr('y',function(d){return height-y(d);}).delay(function(d,i){return i*delay;}).duration(duration).ease(easing);}function withoutAnimation(){bars.attr('height',function(d){return y(d);}).attr('y',function(d){return height-y(d);})}$(window).on('resize',barsResize);$('.sidebar-control').on('click',barsResize);function barsResize(){width=d3Container.node().getBoundingClientRect().width;container.attr("width",width);svg.attr("width",width);x.rangeBands([0,width],0.3);svg.selectAll('.d3-random-bars').attr('width',x.rangeBand()).attr('x',function(d,i){return x(i);});}}progressCounter('#hours-available-progress',38,2,"#F06292",0.68,"icon-watch text-pink-400",'Hours available','64% average')
progressCounter('#goal-progress',38,2,"#5C6BC0",0.82,"icon-trophy3 text-indigo-400",'Productivity goal','87% average')
function progressCounter(element,radius,border,color,end,iconClass,textTitle,textAverage){var d3Container=d3.select(element),startPercent=0,iconSize=32,endPercent=end,twoPi=Math.PI*2,formatPercent=d3.format('.0%'),boxSize=radius*2;var count=Math.abs((endPercent-startPercent)/0.01);var step=endPercent<startPercent?-0.01:0.01;var container=d3Container.append('svg');var svg=container.attr('width',boxSize).attr('height',boxSize).append('g').attr('transform','translate('+(boxSize/2)+','+(boxSize/2)+')');var arc=d3.svg.arc().startAngle(0).innerRadius(radius).outerRadius(radius-border);svg.append('path').attr('class','d3-progress-background').attr('d',arc.endAngle(twoPi)).style('fill','#eee');var foreground=svg.append('path').attr('class','d3-progress-foreground').attr('filter','url(#blur)').style('fill',color).style('stroke',color);var front=svg.append('path').attr('class','d3-progress-front').style('fill',color).style('fill-opacity',1);var numberText=d3.select(element).append('h2').attr('class','mt-15 mb-5')
d3.select(element).append("i").attr("class",iconClass+" counter-icon").attr('style','top: '+((boxSize-iconSize)/2)+'px');d3.select(element).append('div').text(textTitle);d3.select(element).append('div').attr('class','text-size-small text-muted').text(textAverage);function updateProgress(progress){foreground.attr('d',arc.endAngle(twoPi*progress));front.attr('d',arc.endAngle(twoPi*progress));numberText.text(formatPercent(progress));}var progress=startPercent;(function loops(){updateProgress(progress);if(count>0){count--;progress+=step;setTimeout(loops,10);}})();}bulletChart("#bullets",80);function bulletChart(element,height){bulletCore();function bulletCore(){d3.bullet=function(){var orient="left",reverse=false,duration=750,ranges=bulletRanges,markers=bulletMarkers,measures=bulletMeasures,height=30,tickFormat=null;function bullet(g){g.each(function(d,i){var rangez=ranges.call(this,d,i).slice().sort(d3.descending),markerz=markers.call(this,d,i).slice().sort(d3.descending),measurez=measures.call(this,d,i).slice().sort(d3.descending),g=d3.select(this);var x1=d3.scale.linear().domain([0,Math.max(rangez[0],markerz[0],measurez[0])]).range(reverse?[width,0]:[0,width]);var x0=this.__chart__||d3.scale.linear().domain([0,Infinity]).range(x1.range());this.__chart__=x1;var w0=bulletWidth(x0),w1=bulletWidth(x1);var range=g.selectAll(".bullet-range").data(rangez);range.enter().append("rect").attr("class",function(d,i){return"bullet-range bullet-range-"+(i+1);}).attr("width",w0).attr("height",height).attr('rx',2).attr("x",reverse?x0:0).transition().duration(duration).attr("width",w1).attr("x",reverse?x1:0);range.transition().duration(duration).attr("x",reverse?x1:0).attr("width",w1).attr("height",height);var measure=g.selectAll(".bullet-measure").data(measurez);measure.enter().append("rect").attr("class",function(d,i){return"bullet-measure bullet-measure-"+(i+1);}).attr("width",w0).attr("height",height/5).attr("x",reverse?x0:0).attr("y",height/2.5).style("shape-rendering","crispEdges");measure.transition().duration(duration).attr("width",w1).attr("x",reverse?x1:0);measure.transition().duration(duration).attr("width",w1).attr("height",height/5).attr("x",reverse?x1:0).attr("y",height/2.5);var marker=g.selectAll(".bullet-marker").data(markerz);marker.enter().append("line").attr("class",function(d,i){return"bullet-marker bullet-marker-"+(i+1);}).attr("x1",x0).attr("x2",x0).attr("y1",height/6).attr("y2",height*5/6);marker.transition().duration(duration).attr("x1",x1).attr("x2",x1);marker.transition().duration(duration).attr("x1",x1).attr("x2",x1).attr("y1",height/6).attr("y2",height*5/6);var format=tickFormat||x1.tickFormat(8);var tick=g.selectAll(".bullet-tick").data(x1.ticks(8),function(d){return this.textContent||format(d);});var tickEnter=tick.enter().append("g").attr("class","bullet-tick").attr("transform",bulletTranslate(x0)).style("opacity",1e-6);tickEnter.append("line").attr("y1",height).attr("y2",(height*7/6)+3);tickEnter.append("text").attr("text-anchor","middle").attr("dy","1em").attr("y",(height*7/6)+4).text(format);tickEnter.transition().duration(duration).attr("transform",bulletTranslate(x1)).style("opacity",1);var tickUpdate=tick.transition().duration(duration).attr("transform",bulletTranslate(x1)).style("opacity",1);tickUpdate.select("line").attr("y1",height+3).attr("y2",(height*7/6)+3);tickUpdate.select("text").attr("y",(height*7/6)+4);tick.exit().transition().duration(duration).attr("transform",bulletTranslate(x1)).style("opacity",1e-6).remove();$(window).on('resize',resizeBulletsCore);$('.sidebar-control').on('click',resizeBulletsCore);function resizeBulletsCore(){width=d3.select("#bullets").node().getBoundingClientRect().width-margin.left-margin.right;w1=bulletWidth(x1);x1.range(reverse?[width,0]:[0,width]);g.selectAll(".bullet-measure").attr("width",w1).attr("x",reverse?x1:0);g.selectAll(".bullet-range").attr("width",w1).attr("x",reverse?x1:0);g.selectAll(".bullet-marker").attr("x1",x1).attr("x2",x1)
g.selectAll(".bullet-tick").attr("transform",bulletTranslate(x1))}});d3.timer.flush();}bullet.orient=function(x){if(!arguments.length)return orient;orient=x;reverse=orient=="right"||orient=="bottom";return bullet;};bullet.ranges=function(x){if(!arguments.length)return ranges;ranges=x;return bullet;};bullet.markers=function(x){if(!arguments.length)return markers;markers=x;return bullet;};bullet.measures=function(x){if(!arguments.length)return measures;measures=x;return bullet;};bullet.width=function(x){if(!arguments.length)return width;width=x;return bullet;};bullet.height=function(x){if(!arguments.length)return height;height=x;return bullet;};bullet.tickFormat=function(x){if(!arguments.length)return tickFormat;tickFormat=x;return bullet;};bullet.duration=function(x){if(!arguments.length)return duration;duration=x;return bullet;};return bullet;};function bulletRanges(d){return d.ranges;}function bulletMarkers(d){return d.markers;}function bulletMeasures(d){return d.measures;}function bulletTranslate(x){return function(d){return"translate("+x(d)+",0)";};}function bulletWidth(x){var x0=x(0);return function(d){return Math.abs(x(d)-x0);};}}var d3Container=d3.select(element),margin={top:20,right:10,bottom:35,left:10},width=width=d3Container.node().getBoundingClientRect().width-margin.left-margin.right,height=height-margin.top-margin.bottom;var chart=d3.bullet().width(width).height(height);d3.json("assets/demo_data/dashboard/bullets.json",function(error,data){if(error)return console.error(error);var container=d3Container.selectAll("svg").data(data).enter().append('svg');var svg=container.attr("class",function(d,i){return"bullet-"+(i+1);}).attr('width',width+margin.left+margin.right).attr('height',height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(chart);var title=svg.append("g").style("text-anchor","start");title.append("text").attr("class","bullet-title").attr('y',-10).text(function(d){return d.title;});title.append("text").attr("class","bullet-subtitle").attr('x',width).attr('y',-10).style("text-anchor","end").text(function(d){return d.subtitle;}).style('opacity',0).transition().duration(500).delay(500).style('opacity',1);var interval=function(){svg.datum(randomize).call(chart.duration(750));}
var intervalIds=[];intervalIds.push(setInterval(function(){interval()},5000));var realtime=document.querySelector('.switcher');var realtimeInit=new Switchery(realtime);realtime.onchange=function(){if(realtime.checked){intervalIds.push(setInterval(function(){interval()},5000));}else{for(var i=0;i<intervalIds.length;i++){clearInterval(intervalIds[i]);}}};$(window).on('resize',bulletResize);$('.sidebar-control').on('click',bulletResize);function bulletResize(){width=d3Container.node().getBoundingClientRect().width-margin.left-margin.right;container.attr("width",width+margin.left+margin.right);svg.attr("width",width+margin.left+margin.right);svg.selectAll('.bullet-subtitle').attr("x",width);}});function randomize(d){if(!d.randomizer)d.randomizer=randomizer(d);d.ranges=d.ranges.map(d.randomizer);d.markers=d.markers.map(d.randomizer);d.measures=d.measures.map(d.randomizer);return d;}function randomizer(d){var k=d3.max(d.ranges)*.2;return function(d){return Math.max(0,d+k*(Math.random()-.5));};}}$(".table tr").each(function(i){var $title=$(this).find('.letter-icon-title'),letter=$title.eq(0).text().charAt(0).toUpperCase();var $icon=$(this).find('.letter-icon');$icon.eq(0).text(letter);});});